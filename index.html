
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <link rel="stylesheet" href="css/styles.css" type="text/css" media="screen"/>
    <link rel="alternate" type="application/rss+xml" title="ExoMemory" href="http://steveliles.github.com/rss.xml" />
    <link href='http://fonts.googleapis.com/css?family=Gochi+Hand' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:700' rel='stylesheet' type='text/css'>
    <meta name="description" content="Thoughts on Java, GWT, programming, and other geek stuff"></meta>
    <script type="text/javascript" src="google-analytics.js"></script>
    <title>Steve Liles' Blog</title>
  </head>
  <body>
    <div>
      <div class="site-header">
        <div class="left">
          <a href="/index.html"><h1>ExoMemory</h1></a>
          <h2>Because I'll forget it if I don't write it down...</h2>
        </div>
        <div class="right">
	  <a rel="author" href="http://steveliles.github.com/about_me.html"><img src="images/lego.png"></a>
        </div>
      </div>
      <div class="nav">
        <span>
          <a rel="me" href="https://plus.google.com/105248011271585565954"><img src="http://www.google.com/images/icons/ui/gprofile_button-16.png" width="16" height="16"></a>
          <a rel="me" href="http://www.twitter.com/steveliles"><img src="http://twitter-badges.s3.amazonaws.com/t_mini-a.png" alt="Follow steveliles on Twitter"></a>
	  <a rel="me" href="http://uk.linkedin.com/in/steveliles"><img src="http://www.linkedin.com/img/webpromo/btn_in_20x15.png" width="20" height="15" alt="View my LinkedIn profile"></a>
	  <form action="http://www.google.com/search" method="get">
            <input type="hidden" name="q" value="site:steveliles.github.com">
            <input type="text" name="q" placeholder="search"></input>
          </form>
	  <a href="rss.xml"><img src="images/rss.png" width="16" height="16" alt="Subscribe to RSS feed"></a>
        </span>
      </div>
      <div class="content">
        <div class="main">
	    <div class="article" itemscope itemtype="http://schema.org/BlogPosting" inLanguage="en-GB" isFamilyFriendly="true" wordCount="1,365" description="While creating icons for my Android app "Comic Strip It!", I spent some time learning to use Gimp to create Comic-book style graphics. Here's a couple of tricks I picked upÉ">
              <span class="meta" itemprop="datePublished"><time datetime="2012-02-12">February 12, 2012</time></span>
              <a itemprop="url" href="creating_comic_book_style_icons_with_gimp.html"><h1 itemprop="name" itemprop="headline">Creating comic-book style icons with Gimp</h1></a>
	      <span itemprop="articleBody"><p>I've long had a love-hate relationship with Gimp. I <em>hate</em> the MDI interface - all those windows really grate on my nerves. I <em>love</em> that its a really great and full-featured graphics package, and free. </p>

<p>In the past I've fired it up to do all kinds of little jobs, but never really tried to use it to compose artwork of any complexity from scratch. That changed recently when I needed to create some nice icons for my Android app <a href="https://market.android.com/details?id=com.roundwoodstudios.comicstripitpro">Comic Strip It!</a>.</p>

<p>Finally, and almost by accident, I've learned how to use paths, masks, and layers, as well as a few of the filters, and managed to turn out some icons that I'm not too embarrassed by! Here's some examples:</p>

<p><img src="https://lh6.googleusercontent.com/-ZOZmYN_bszw/TzgptOjJ1bI/AAAAAAAAIzE/emf1ce6lnmc/s144/ic_pick.png" alt="pick from gallery icon" />
<img src="https://lh4.googleusercontent.com/-VNKQco0IpEQ/TzgpsWgymEI/AAAAAAAAIy0/Oit-b0pWdZw/s144/ic_next.png" alt="next arrow icon" />
<img src="https://lh5.googleusercontent.com/-ujoySEPeK0A/Tzgpl7iVAkI/AAAAAAAAIxU/37zF9BjWRx8/s144/ic_accept.png" alt="accept icon" />
<img src="https://lh5.googleusercontent.com/-Of1oDouIR9I/Tzgpt8pNT-I/AAAAAAAAIzI/eztu4X6JMi8/s144/ic_preview.png" alt="magnifier preview icon" />
<img src="https://lh3.googleusercontent.com/-J5MhVusK6fo/Tzgpmf9lF0I/AAAAAAAAIxY/wUCI4F6mJQ4/s144/ic_camera.png" alt="camera icon" />
<img src="https://lh5.googleusercontent.com/-y-53iL_XMes/TzgpvXzrHbI/AAAAAAAAIzc/TpgXHLEEqQ4/s144/ic_save.png" alt="piggy-bank save icon" />
<img src="https://lh6.googleusercontent.com/-ixZwd4Yj6iI/Tzgpvuf_MWI/AAAAAAAAIzk/6wt6dUYwJNw/s144/ic_share.png" alt="double-arrow share icon" />
<img src="https://lh4.googleusercontent.com/-F0tC5dE6g4k/TzgpoiXN8uI/AAAAAAAAIx0/nOQun526Okg/s144/ic_font_size.png" alt="text-size icon" />
<img src="https://lh3.googleusercontent.com/-1TdNH4i5rxY/TzgppsCAugI/AAAAAAAAIyQ/_A6cDO7vWZY/s144/ic_help.png" alt="help icon" />
<img src="https://lh4.googleusercontent.com/-0DTcVRMkfnc/TzgpweaWEzI/AAAAAAAAI0E/I_asX4AQbWE/s144/ic_speech.png" alt="speech bubble icon" />
<img src="https://lh5.googleusercontent.com/-fXTBnJIYg5U/TzgppohC8nI/AAAAAAAAIyI/UOYY65oDbL4/s144/ic_image_effects.png" alt="special effects / fx icon" />
<img src="https://lh4.googleusercontent.com/-zK2LU5sVZ1g/TzgprvV1rlI/AAAAAAAAIyk/EUfWgvTnmJc/s144/ic_new_strip.png" alt="new strip icon" /></p>

<p>Since the app is all about creating comic strips I wanted icons that really fit with that idea, so I spent some time looking at comics and comic graphics. </p>

<p>The half-tone effect - coloured dots printed in rows at different sizes and angles to create the illusion of different shades of colour - figures heavily in print comic-books, and has a such a recognisable stylistic effect that I settled on using that as much as possible. My attempts at re-creating it aren't "real" half-tones, but I think the effect works.</p>

<h2>A few working practices</h2>

<p>I drew all my icons at 512x512 pixels, then re-scaled for use. Android wants 4 different sizes to cater for four different screen densities (low - 32x32, medium - 48x48, high - 72x72, extra-high - 96x96). </p>

<p>Drawing at the much larger size of 512x512 just makes it much easier to work, covers minor errors once you scale down, <em>and</em> means that you usually end up with a decent quality scaled image.</p>

<p>I save all the original icons using Gimp's native XCF file format, which retains the layers and masks and so on - this means I can always go back later and make small changes if I need to (and I did, many times).</p>

<p>Because my laptop runs Ubuntu I saved my icons in a folder shared by Ubuntu One (cloud backup and replication), but this didn't always work out well - connectivity issues on a few evenings meant that I got conflicting versions between my laptop and my desktop, and it wasn't too easy to sort out. </p>

<p>In future I will use <a href="http://git-scm.com/">git</a>, as that puts control of when you update in your hands, and provides explicit versioning and access to old versions. I've upgraded to a paid <a href="http://www.github.com">github</a> account now that my app is live in the Android Market, and all my source-code lives there now.</p>

<p>So, to the icons...</p>

<h2>Creating a halftone background</h2>

<p>Almost all of my icons use a circular splash of half-tone colour as a background. It took me a good long time to figure out how to do this properly, but once you know how its done its actually very quick to re-create.</p>

<h4>Step 1: The background gradient</h4>

<p>First, create a new 512x512 file, and paint a linear gradient filling the entire image. To paint a gradient:</p>

<ol>
<li>select the "blend" tool, and make sure its send to "linear blend"</li>
<li>select foreground and background colours as the start and end colours for your gradient</li>
<li>hold down the left mouse-button in one corner of your image, move to the diagonally opposite corner and release the button to paint the gradient</li>
</ol>

<p>I picked a deep orange foreground colour, a paler orange-yellow background colour, and drew the gradient from bottom-left to top-right, resulting in the following image:</p>

<p><img src="https://lh6.googleusercontent.com/-RFRY_hGNiNs/Tzg2wBkpxyI/AAAAAAAAI1I/SiObSnce6wM/s800/halftone-background-step1.png" alt="step 1 - the background gradient" /></p>

<h4>Step 2: The half-tone mask</h4>

<p>To create the half-tone dot effect we're going to use one of Gimp's built in filters - "News-print". We want the dots to cluster heavily in the middle, then space further apart and get smaller the further they are from the centre of the image. Here's how we do that:</p>

<ol>
<li>Create a new layer, above the existing colour gradient. I like to do that directly in the "Layers" palette by right-clicking and choosing "New Layer", making sure to select "Transparency" as the layer fill type, and give it a name (I usually call this layer "bg_halftone").</li>
<li>Make sure the layer is above your colour gradient in the layer palette. If it isn't, click and drag and drop it above the background layer.</li>
<li>Select the "blend" tool again, and choose full black as the foreground colour, and full white as the background colour. This time we want to do a "radial blend".</li>
<li>Move the mouse to the centre of your image, hold down the left button, and drag towards the right-hand edge. When you release the mouse you'll get a disc with a black centre, graduating through grey on a white background, as shown below.</li>
</ol>

<p><img src="https://lh5.googleusercontent.com/-DVjmNBG53fw/Tzg56PUUREI/AAAAAAAAI1g/AousTkX7ozY/s800/halftone-background-step2.png" alt="black-to-white gradient disc" /></p>

<p>Now we're going to convert the smooth black-to-white gradient of our disc to a half-tone effect. We'll do that using the News-print filter:</p>

<ol>
<li>From Gimp's "Filters" menu, choose "Distorts -> Newsprint"</li>
<li>Increase the cell-size to something reasonably large - 25 to 30 works well if you're going to scale the final image down as I did. If you won't be scaling the image down, stick to something less than 10.</li>
<li>Visit the three colour channel tabs (red/green/blue) and set the same angle in all of them. I'm using 15 in this example.</li>
<li>Finally, set the anti-aliasing oversample to 15, and apply the filter.</li>
</ol>

<p><img src="https://lh3.googleusercontent.com/-jJ3x3SwAO10/Tzg7UDPi7RI/AAAAAAAAI14/gZLsPkiYrbo/s800/halftone-background-step3.png" alt="newsprint effect" /></p>

<p>Almost done! We just need to let the colour shine through from the background layer. I tried various ways of doing this. Masks worked well, and "Select->By Color" isn't bad (but does'nt capture anti-aliased areas perfectly). Eventually I got into the habit of a much simpler way:</p>

<ol>
<li>From Gimp's "Colors" menu choose "Color to Alpha"</li>
<li>Click the colour-box (from:) and select full black</li>
<li>Click OK and you'll see your background gradient shine through the dots</li>
</ol>

<p><em>Note: If you noticed that the dots don't quite match up between the following image and the others on this page, its because I added this image after I originally posted, and had to re-create it because I had already deleted the .xcf file I originally used while writing this post. Oops.</em></p>

<p><img src="https://lh6.googleusercontent.com/-W8yUnXLKhWY/TzjVIugjWwI/AAAAAAAAI2o/BZIgOGNtrD8/s800/halftone-background-step4a.png" alt="" /></p>

<p>For completeness, here's the "Select->By Color" method, which I don't use any more because it involves more steps and leaves the dots with slightly jagged edges:</p>

<ol>
<li>From Gimp's "Select" menu, choose "By Color", and then select the white background of the image.</li>
<li>Invert the selection (ctrl-i) so that the black dots are now selected. (We could have selected the black dots initially, but I find that if you do this you end up with black artefacts after the next step)</li>
<li>From the "Edit" menu choose "Clear", or hit the delete key, if you have one (my laptop doesn't). You should now see the gradient colour from your background layer shining through the holes you just made in the top-most layer.</li>
<li>De-select (ctrl-a) and merge the two layers (right-click in the layers palette and choose "merge visible..")</li>
</ol>

<p><img src="https://lh4.googleusercontent.com/-Kvxw_pqsjV0/Tzg-D_dIzXI/AAAAAAAAI2Q/egDujGmzQfg/s800/halftone-background-step4.png" alt="finished half-tone background" /></p>

<p>Notice that the edges of the dots in this version of the image are decidedly jagged, compared to the version created by using the colour-to-alpha technique. This is to do with the select-by-colour method not including anti-aliasing pixels that are closer to white than black in the selection.</p>

<p>I used this technique to create the backgrounds for my icons, adding one more step: gaussian blur to de-focus the background and make the foreground icon stand out nice and sharp.</p>

<p>I used the same technique to pattern-fill the icon detail by using paths and selections. I'll save the details of that for another post.</p>
</span>

              <ul class="keywords">
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Gimp">Gimp</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Icon">Icon</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Comic-Book">Comic-Book</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Half-tone">Half-tone</a></li>
              </ul>
              <div style="clear:both"></div>

	        <a href="creating_comic_book_style_icons_with_gimp.html">Comment on this post</a>

            </div>
	    <div class="article" itemscope itemtype="http://schema.org/BlogPosting" inLanguage="en-GB" isFamilyFriendly="true" wordCount="272" description="A couple of commands I've been using to create iOS-style icons with ImageMagick">
              <span class="meta" itemprop="datePublished"><time datetime="2012-01-27">January 27, 2012</time></span>
              <a itemprop="url" href="creating_ios_style_icons_with_imagemagick.html"><h1 itemprop="name" itemprop="headline">Creating iOS style icons with ImageMagick</h1></a>
	      <span itemprop="articleBody"><p>Icons for iOS apps are generally provided by the app with square corners and no "sheen". The rounded corners and glossy sheen are added by iOS.</p>

<p>If you want to achieve the iOS icon look on icons used elsewhere (Android, Web, etc), you need to round the corners and apply the sheen yourself.</p>

<p>What follows is my quick attempt to give the iOS treatment to this 512x512 icon:</p>

<p><img src="https://lh6.googleusercontent.com/-UaUMm3U99L8/TyLi2QD6E-I/AAAAAAAAIq4/gl-21ZMoBg4/s800/in.png" alt="Original Icon" /></p>

<h3>Transparent Rounded Corners</h3>

<p>OK, transparent rounded corners are actually the easy part. There are several ways to get ImageMagick to do this. The easiest (read: shortest) command i've found looks like this:</p>

<pre><code>convert -size 512x512 xc:none -fill white -draw \
    'roundRectangle 0,0 512,512 50,50' in.png \
    -compose SrcIn -composite rounded.png
</code></pre>

<p>So now we have this:</p>

<p><img src="https://lh3.googleusercontent.com/-ndvucr5orZ4/TyLmOX_XYqI/AAAAAAAAIrc/gMdrV_Hvil8/s800/test.png" alt="Rounded Corners" /></p>

<h3>Overlay some sheen</h3>

<p>The sheen is trickier. I imagine that real ImageMagick pro's could generate the sheen mask with some deft command-line, but I'm nowhere near that proficient.</p>

<p>Instead I created the following image in Gimp - exactly how is a topic for another post :). The black background is coming from the div containing the image - where you see black is actually transparent in my png, and the grey highlight at the top is semi-transparent:</p>

<div style="background-color:black; width:512px;"><img src="https://lh5.googleusercontent.com/-gssBzUQ5a0c/TyLi4f6F6fI/AAAAAAAAIrE/Lc9HhdfRQN8/s800/gloss-over.png"></div>

<p>To composite the rounded-corner image with the glossy overlay (gloss-over.png), I use this ImageMagick command:</p>

<pre><code>convert -draw "image Screen 0,0 0,0 'gloss-over.png'" \
    rounded.png final.png
</code></pre>

<p><img src="https://lh4.googleusercontent.com/-YaXSMS3j_Ws/TyLmvOKZLMI/AAAAAAAAIr0/h_nP4EQ8k94/s800/final.png" alt="Final iOS style image" /></p>
</span>

              <ul class="keywords">
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=ImageMagick">ImageMagick</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=iOS">iOS</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Icon">Icon</a></li>
              </ul>
              <div style="clear:both"></div>

	        <a href="creating_ios_style_icons_with_imagemagick.html">Comment on this post</a>

            </div>
	    <div class="article" itemscope itemtype="http://schema.org/BlogPosting" inLanguage="en-GB" isFamilyFriendly="true" wordCount="2,457" description="Invoking an external process from Java appears easy enough but there are sooo many gotchas to watch out for. Here I try to describe some of them, and suggest some ways to avoid those problems.">
              <span class="meta" itemprop="datePublished"><time datetime="2012-01-26">January 26, 2012</time></span>
              <a itemprop="url" href="invoking_processes_from_java.html"><h1 itemprop="name" itemprop="headline">Invoking Processes from Java</h1></a>
	      <span itemprop="articleBody"><p>Invoking an external process from Java appears easy enough but there are sooo many gotchas to watch out for. Typical problems that arise include:</p>

<ol>
<li><em>Hanging Processes</em> - The invoked process "hangs" and never completes (because it is waiting for input that never comes, or for the output buffer(s) to be drained).</li>
<li><em>Failure to execute</em> - Commands that work fine from the cmdline refuse to run when invoked from Java (because the parameters are passed incorrectly).</li>
<li><em>Mysterious issues in production</em> - Peculiar situations where processes cease to work after running happily for some time (the file-handle quota is exhausted because the IO streams are not being correctly closed).</li>
</ol>

<p>The first two are irritating, but at least they present themselves immediately and are typically fixed before the code leaves the developer. </p>

<p>The last problem is much more insidious and often only rears its head after some time in production (sometimes this is because it takes time and a significant number of executions before it manifests, other times it is because of differences between the development and production environments).</p>

<p>Lets have a look at the general solution to each of these problems. Later I'll list some code that I've been using to invoke processes safely.</p>

<h3>Hanging Processes</h3>

<p><em>Symptoms:</em> When invoked, the process starts but does not complete. Sometimes this may appear to be caused by the input that is being fed to the process (e.g. with input A it works but with input B it does not), which adds to the confusion over why the problem occurs.</p>

<p><em>Cause:</em> The most common reason for this problem is failing to pump input into the program, and drain output buffers from the program, using separate threads.</p>

<p>If a program is consuming sufficient input via standard-input (stdin), or producing sufficient output via stdout or stderr, the limited buffers available to it will fill up. Until those buffers are drained the process will block on IO to those buffers, so the process is effectively hung.</p>

<p><em>Solution:</em> When you invoke any process from Java, you must use separate threads to pump data to/from stdin, stdout, and stderr:</p>

<pre><code>// invoke the process, keeping a handle to it for later...
final Process _p = Runtime.getRuntime().exec("some-command-or-other");

// Handle stdout...
new Thread() {
    public void run() {
    try {
            Streams.copy(_p.getInputStream(), System.out);
        } catch (Exception anExc) {
            anExc.printStackTrace();
        }
    }
}.start();

// Handle stderr...
new Thread() {
    public void run() {
    try {
            Streams.copy(_p.getInputStream(), System.out);
        } catch (Exception anExc) {
            anExc.printStackTrace();
        }
    }
}.start();
</code></pre>

<p>Correctly pumping data into and out of the std io buffers will keep your processes from hanging.</p>

<h3>Failure to communicate</h3>

<p><em>Symptoms:</em> You have a command-line that works perfectly when executed at the shell prompt, but invoking it from Java results in strange errors and, perhaps, complaints about invalid parameters.</p>

<p><em>Cause:</em> Typically this occurs when you try to pass parameters which include spaces - for example file-names - which you escape or quote at the shell prompt.</p>

<p><a href="https://lh4.googleusercontent.com/-khRgW4ViBts/TyM8-x7BVZI/AAAAAAAAIsQ/2IiEhj5GdkA/s1600/27.jpg"><img alt="Java invoking ImageMagick - a lego comic strip created with Comic Strip It! for Android" src="https://lh4.googleusercontent.com/-khRgW4ViBts/TyM8-x7BVZI/AAAAAAAAIsQ/2IiEhj5GdkA/s600/27.jpg"></a></p>

<p><em>Example:</em> Running ImageMagick "convert" to add transparent rounded corners to an icon:</p>

<pre><code>convert -size 72x72 xc:none -fill white -draw \
  'roundRectangle 0,0 72,72 15,15' in.png \
  -compose SrcIn -composite out.png
</code></pre>

<p>This command-line works fine at a bash prompt, but if you try to invoke it naively from Java it will likely fail in a variety of interesting ways depending on your platform:</p>

<pre><code>public static void main(String... anArgs) {
    // invoke the process, keeping a handle to it for later...
    final Process _p = Runtime.getRuntime().exec(
        "/usr/bin/convert -size 72x72 xc:none -fill white -draw" +
        " 'roundRectangle 0,0 72,72 15,15' /home/steve/Desktop/in.png" +
        " -compose SrcIn -composite /home/steve/Desktop/out.png"
    );

    // Handle stdout...
    new Thread() {
        public void run() {
            try {
                Streams.copy(_p.getInputStream(), System.out);
            } catch (Exception anExc) {
                anExc.printStackTrace();
            }
        }
    }.start();

    // Handle sderr...
    new Thread() {
        public void run() {
            try {
                Streams.copy(_p.getErrorStream(), System.out);
            } catch (Exception anExc) {
                anExc.printStackTrace();
            }
        }
    }.start();

    // wait for the process to complete
    _p.waitFor();
}
</code></pre>

<p>Whilst the command-line worked fine at the bash prompt, running the same command from Java results in an error message!:</p>

<pre><code>convert: non-conforming drawing primitive definition 
    `roundRectangle' @ error/draw.c/DrawImage/3143.
convert: unable to open image `0,0':  @ error/blob.c/OpenBlob/2489.
convert: unable to open image `72,72':  @ error/blob.c/OpenBlob/2489.
convert: unable to open image `15,15'':  @ error/blob.c/OpenBlob/2489.
convert: non-conforming drawing primitive definition 
    `roundRectangle' @ error/draw.c/DrawImage/3143.
</code></pre>

<p>What's going on!? Basically the command we gave to Runtime.exec has been sliced up at spaces, ignoring the single quotes, and so ImageMagick has seen a very different command-line to the one we presented via the shell.</p>

<p><em>Solution:</em> The solution this time is very easy: Use the overloaded Runtime.exec(..) methods that accept the command <em>and</em> the parameters as an array of String's. Re-writing our previous example:</p>

<pre><code>public static void main(String... anArgs) 
throws Exception {
    // invoke the process, keeping a handle to it for later...
    // note that we pass the command and its params as String's in
    // the same String[]
    final Process _p = Runtime.getRuntime().exec(
        new String[]{
            "/usr/bin/convert",
            "-size", "72x72", "xc:none", "-fill", "white", "-draw",
            "roundRectangle 0,0 72,72 15,15", 
            "/home/steve/Desktop/in.png", "-compose", "SrcIn",
            "-composite", "/home/steve/Desktop/out.png"
        }
    );

    // Handle stdout...
    new Thread() {
        public void run() {
            try {
                Streams.copy(_p.getInputStream(), System.out);
            } catch (Exception anExc) {
                anExc.printStackTrace();
            }
        }
    }.start();

    // Handle sderr...
    new Thread() {
        public void run() {
            try {
                Streams.copy(_p.getErrorStream(), System.out);
            } catch (Exception anExc) {
                anExc.printStackTrace();
            }
        }
    }.start();

    // wait for the process to complete
    _p.waitFor();
}
</code></pre>

<p>Passing your cmdline parameters in a String array instead of as one long String should prevent your parameters from being chewed up and mis-interpreted.</p>

<h3>Mysterious issues in production</h3>

<p><em>Symptoms:</em> For a good while things appear to be working fine. Processes are invoked, do their work, and shut-down. After a while a problem occurs - the processes are no longer being invoked, or hang.</p>

<p><em>Cause:</em> The cause of this is usually exhaustion of the available file-handles, which in turn is caused by failing to correctly close all of the IO streams opened to handle the process IO.</p>

<p><em>Solution:</em> Careful closure of all standard IO streams opened by the process <em>and</em> streams opened by you to consume the data from the standard streams opened by the process. Note: That's SIX streams in total, not just the three that you open to deal with stdin, stdout and stderr! I also recommend calling <code>destroy</code> on the Process object.</p>

<p>I <em>may</em> be being over-cautious in closing the process's own std streams, but I have seen many cases where closing these streams solved problems of leaked file-handles. (btw., A handy tool if you're running a *nix is <code>lsof</code>, which lists open file handles).</p>

<p>Here's how I recommend cleaning up after your process completes (this assumes that you did provide input via stdin):</p>

<pre><code>public static void main(String... anArgs) {
    Process _process = null;
    InputStream _in = null;
    OutputStream _out = null;
    OutputStream _err = null;
    try {
        _process = Runtime.getRuntime().exec( ... );
        // ... don't forget to initialise in, out, and error,
        // .... and consume the streams in separate threads!
        _process.waitFor();
    } finally {
        if( _process != null ) {
            close(_process.getErrorStream());
            close(_process.getOutputStream());
            close(_process.getInputStream());
            _process.destroy();
        }
        close(_in);
        close(_out);
        close(_err);
    }
}

private static void close(InputStream anInput) {
    try {
        if (anInput != null) {
            anInput.close();
        }
    } catch (IOException anExc) {
        anExc.printStackTrace();
    }
}

private static void close(OutputStream anOutput) {
    try {
        if (anOutput != null) {
            anOutput.close();
        }
    } catch (IOException anExc) {
        anExc.printStackTrace();
    }
}
</code></pre>

<p>These days I usually use some utility classes which I've written to wrap all this stuff up and make life a little easier. You can find them in my <a href="https://github.com/steveliles/sjl.io">sjl.io</a> project at github. There's an example of usage in the <code>test</code> source tree - <code>ExternalProcessTest</code> - which invokes ImageMagick.</p>
</span>

              <ul class="keywords">
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Java">Java</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Process">Process</a></li>
              </ul>
              <div style="clear:both"></div>

	        <a href="invoking_processes_from_java.html">Comment on this post</a>

            </div>
	    <div class="article" itemscope itemtype="http://schema.org/BlogPosting" inLanguage="en-GB" isFamilyFriendly="true" wordCount="87" description="Couldn't resist posting my latest Comic Strip It! creation, testing the new speech balloon styles and colours, and featuring my latest lego mini-figure - the mad scientist!">
              <span class="meta" itemprop="datePublished"><time datetime="2012-01-25">January 25, 2012</time></span>
              <a itemprop="url" href="another_mini_figure_another_comic_strip.html"><h1 itemprop="name" itemprop="headline">Another mini-figure, another comic strip...</h1></a>
	      <span itemprop="articleBody"><p>Here's a quick taster of the new speech-balloon styles and colours available in Comic Strip It! v1.4.2 (and featuring my latest lego minifigure - the Mad Scientist).</p>

<p><a target="top" href="https://lh5.googleusercontent.com/-ZPNFZHx_4vA/TyCF5AJcchI/AAAAAAAAIpk/qpDlLOxZLBg/s1600/20.jpg"><img alt="Joe Hazmat vs Mad Scientist, a lego comic strip made with Comic Strip It!" src="https://lh5.googleusercontent.com/-ZPNFZHx_4vA/TyCF5AJcchI/AAAAAAAAIpk/qpDlLOxZLBg/s600/20.jpg"></a></p>

<table>
 <tr>
  <td>Sorry iOS folks, <a href="https://market.android.com/details?id=com.roundwoodstudios.comicstripitpro">Comic Strip It!</a> is only available for Android at this time. Android folks can jump to the Market with this QR code.</td>
  <td><a href="https://market.android.com/details?id=com.roundwoodstudios.comicstripitpro"><img src="images/qr_code.png"></a></td>
 </tr>
</table>
</span>

              <ul class="keywords">
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Comic Strip It">Comic Strip It</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Android">Android</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=App">App</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Comic Strip">Comic Strip</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Lego">Lego</a></li>
              </ul>
              <div style="clear:both"></div>

	        <a href="another_mini_figure_another_comic_strip.html">Comment on this post</a>

            </div>
	    <div class="article" itemscope itemtype="http://schema.org/BlogPosting" inLanguage="en-GB" isFamilyFriendly="true" wordCount="555" description="I blogged recently about how we've set things up for team development using Maven, Android and Eclipse. This follow up post describes how someone joining the team would go about setting up and getting to work...">
              <span class="meta" itemprop="datePublished"><time datetime="2012-01-23">January 23, 2012</time></span>
              <a itemprop="url" href="maven_android_and_eclipse_joining_the_team.html"><h1 itemprop="name" itemprop="headline">Maven, Android and Eclipse - joining the team</h1></a>
	      <span itemprop="articleBody"><p>I blogged recently about <a href="http://steveliles.github.com/converting_eclipse_adt_android_projects_to_build_with_maven.html">building Android projects with Maven</a>, and <a href="http://steveliles.github.com/setting_up_maven_android_and_svn_for_team_development_of_multiple_applications.html">how we've set things up for team development</a> using Maven, Android and Eclipse. This follow up post describes how someone joining the team would go about setting up and getting to work...</p>

<p>To join in the fun you need a straight-forward installation of the following pre-requisite tools:</p>

<ul>
<li>Eclipse (I usually go for Eclipse classic)</li>
<li>Subversion</li>
<li>Maven 3.0.3</li>
<li>Android SDK</li>
</ul>

<p>You will then need the following Eclipse plugins:</p>

<ul>
<li><a href="http://developer.android.com/sdk/eclipse-adt.html">Android Development Tools (ADT)</a> - update site: https://dl-ssl.google.com/android/eclipse/</li>
<li><a href="http://eclipse.org/m2e/">m2eclipse</a> - update site: http://download.eclipse.org/technology/m2e/releases</li>
<li><a href="http://rgladwell.github.com/m2e-android/">m2e-android</a> - Whilst you can install this like a normal plugin (thx Ricardo for the correction), I recommend that you <em>don't</em> use an update site to install this - instead, follow the instructions at the bottom of this post (after the comic), or at the <a href="http://rgladwell.github.com/m2e-android/">m2e-android site</a>.</li>
</ul>

<p>Since you are setting up to join an existing team, most of the maven configuration has presumably already been done for you. To get working on a project (assuming it is set up <a href="http://steveliles.github.com/setting_up_maven_android_and_svn_for_team_development_of_multiple_applications.html">as I described</a>) you need to check out two projects:</p>

<ol>
<li>The "parent" project containing the common configuration for all Android-Maven projects</li>
<li>The project you actually need to work on</li>
<li>(OK, yes, also any apklib library projects if you need to debug or work on those too)</li>
</ol>

<p>I highly recommend checking out so that all of these projects are siblings in a common projects directory.</p>

<p>The <em>biggest</em> single difference from ADT's usual working style is that you can't (currently) work with the apklib projects as project dependencies <a href="http://steveliles.github.com/the_dreaded_unexpected_top_level_exception.html">because of this issue</a>. Instead, if you make any changes to an apklib project, you'll need to <code>mvn install</code> or <code>mvn deploy</code> it before you can see the change in your dependent apk projects.</p>

<p>I found that I had to "mvn install" each of the apklib projects locally before the dependent projects would build, as the remotely deployed projects for some reason did not include the pom resource - I haven't yet had time to investigate why.</p>

<p><a target="top" href="https://lh4.googleusercontent.com/-WtXO6OjDnEA/Tx1KHLcuupI/AAAAAAAAIoA/HyxxXrw5i10/s1600/75.jpg"><img alt="Converting Eclipse ADT projects to build with Maven, a lego comic strip made with Comic Strip It!" src="https://lh4.googleusercontent.com/-WtXO6OjDnEA/Tx1KHLcuupI/AAAAAAAAIoA/HyxxXrw5i10/s600/75.jpg"></a></p>

<h3>Installing M2E-Android</h3>

<p><em>Don't install this like a normal Eclipse feature!</em> To install M2E-Android, open an Android-Maven project and open the pom.xml. You should see that the <packaging> element is being highlighted as an error, because without M2E-Android, M2Eclipse does not understand the <code>apk</code> or <code>apklib</code> packaging types.</p>

<p>In the header of the pom.xml editor you should see a red error message: <code>plugin execution not covered by lifecycle configuration...</code>.</p>

<p><img src="https://lh5.googleusercontent.com/-Aki7I_BiCLw/Tx6hX3ZXmkI/AAAAAAAAIoU/KNQvbH5sNRI/s600/plugin-execution-crop.png" alt="error when pom packaging set to apk or apklib" /></p>

<p>Click the error and some details open up, including two quick fixes. Click the first quick fix ("discover new m2e connectors"). The following dialog pops up and after a short search, shows the m2e-android connector:</p>

<p><img src="https://lh4.googleusercontent.com/-YeihPZ0PxWQ/TwRWknaVQeI/AAAAAAAAIas/0NnoMugrFa4/s800/install-m2e-connectors.png" alt="discover connectors dialog" /></p>

<p>Install the connector and the warnings <em>should</em> go away. Actually on one of my two machines they did not - I don't know why, but I had to take the 2nd quick-fix option of turning it off in Eclipse. For me that's just about ok, as I want the maven build to be the master anyway.</p>
</span>

              <ul class="keywords">
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Maven">Maven</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Android">Android</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=Eclipse">Eclipse</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=m2e-Android">m2e-Android</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=m2eclipse">m2eclipse</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=ADT">ADT</a></li>
              </ul>
              <div style="clear:both"></div>

	        <a href="maven_android_and_eclipse_joining_the_team.html">Comment on this post</a>

            </div>
        </div>
        <div class="sidebar">
          <div>
            <div class="twitter-feed" show="4" account="steveliles">
              <h5>Recent Tweets</h5>            
              <ul class="tweets">
                <li class="tweet-template" style="display:none">        
                  <span class="text"></span>&nbsp;<span class="date" format="yyyy"></span>
                </li>
              </ul>
              <a href="https://twitter.com/steveliles" class="twitter-follow-button" data-show-count="false">Follow @steveliles</a>
	      <script src="//platform.twitter.com/widgets.js" type="text/javascript"></script>
            </div>
          </div>
          <div>
            <a href="article-archive.html"><h5>Recent Posts</h5></a>
            <ul>
                <li><a href="creating_comic_book_style_icons_with_gimp.html">Creating comic-book style icons with Gimp</a><span class="date"> - Feb 12, 2012</span></li>
                <li><a href="creating_ios_style_icons_with_imagemagick.html">Creating iOS style icons with ImageMagick</a><span class="date"> - Jan 27, 2012</span></li>
                <li><a href="invoking_processes_from_java.html">Invoking Processes from Java</a><span class="date"> - Jan 26, 2012</span></li>
                <li><a href="another_mini_figure_another_comic_strip.html">Another mini-figure, another comic strip...</a><span class="date"> - Jan 25, 2012</span></li>
                <li><a href="maven_android_and_eclipse_joining_the_team.html">Maven, Android and Eclipse - joining the team</a><span class="date"> - Jan 23, 2012</span></li>
            </ul>
            <a href="article-archive.html">Older posts...</a>
          </div>
        </div>
      </div>
      <div class="nav">
        <div class="links">
          
          <div class="next"><a title="next" href="index_1.html">Older Posts</a></div>
        </div>
      </div>
    </div>
    <script type="text/javascript" language="javascript" src="blog/blog.nocache.js"></script>
  </body>
</html>

