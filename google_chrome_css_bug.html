
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <link rel="stylesheet" href="css/styles.css" type="text/css" media="screen"/>
    <link rel="alternate" type="application/rss+xml" title="ExoMemory" href="http://steveliles.github.com/rss.xml" />
    <link href='http://fonts.googleapis.com/css?family=Gochi+Hand' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:700' rel='stylesheet' type='text/css'>
      <meta name="keywords" content="css" itemprop="keywords"></meta>
      <meta name="keywords" content="chrome" itemprop="keywords"></meta>
      <meta name="keywords" content="bug" itemprop="keywords"></meta>
      <meta name="keywords" content="contenteditable" itemprop="keywords"></meta>
    <meta name="description" content="Today I found a bug in Google Chrome contenteditable div's that has the craziest failure-mode imaginable - backspace stops working at the extreme ends of the content, so you can't delete the first character, and you can't delete more than one character from the end of the content without losing focus."></meta>
    <script type="text/javascript" src="google-analytics.js"></script>
    <title>Google Chrome CSS bug</title>
  </head>
  <body>
    <div>
      <div class="site-header">
        <div class="left">
          <a href="/index.html"><h2>Because I'll forget it if I don't write it down...</h2></a>
        </div>
        <div class="right">
	  <a rel="author" href="http://steveliles.github.com/about_me.html"><img src="images/lego-small.png"></a>
        </div>
      </div>
      <div class="nav">
        <span>
          <a rel="me" href="https://plus.google.com/105248011271585565954"><img src="https://ssl.gstatic.com/images/icons/gplus-16.png" width="16" height="16"></a>
          <a rel="me" href="http://www.twitter.com/steveliles"><img src="http://twitter-badges.s3.amazonaws.com/t_mini-a.png" alt="Follow steveliles on Twitter"></a>
	  <a rel="me" href="http://uk.linkedin.com/in/steveliles"><img src="http://www.linkedin.com/img/webpromo/btn_in_20x15.png" width="20" height="15" alt="View my LinkedIn profile"></a>
	  <form action="http://www.google.com/search" method="get">
            <input type="hidden" name="q" value="site:steveliles.github.com">
            <input type="text" name="q" placeholder="search"></input>
          </form>
	  <a href="rss.xml"><img src="images/rss.png" width="16" height="16" alt="Subscribe to RSS feed"></a>
        </span>
      </div>
      <div class="content">
        <div class="main">
	    <div class="article" itemscope itemtype="http://schema.org/BlogPosting" inLanguage="en-GB" isFamilyFriendly="true" wordCount="660" description="Today I found a bug in Google Chrome contenteditable div's that has the craziest failure-mode imaginable - backspace stops working at the extreme ends of the content, so you can't delete the first character, and you can't delete more than one character from the end of the content without losing focus.">
              <span class="meta" itemprop="datePublished"><time datetime="2011-12-13">December 13, 2011</time></span>
              <a itemprop="url" href="google_chrome_css_bug.html"><h1 itemprop="name" itemprop="headline">Google Chrome CSS bug</h1></a>
	      <span itemprop="articleBody"><p><style>
.s1 { display:inline; }
.s2 { display:table; }
</style>
Today while working on a project that uses <code>contenteditable &lt;div&gt;</code> elements I got stuck on a bug for a good long time because of the crazy failure-mode it exhibited. You can try for yourself in the <code>contenteditable</code> below (sooner or later I hope this bug will be fixed and the example will stop working :)).</p>

<div class="example">
  <div class="s1 s2" contenteditable="true">Try deleting the first character in this sentence (you won't be able to), or the last (the caret will disappear after deleting the character)</div>
</div>

<p>I'm working on a reasonably complex editor using Google Web Toolkit (GWT) with multiple content-editable <code>&lt;div&gt;</code> elements used to collect text input. You might be wondering why we're using <code>contenteditable</code> instead of <code>&lt;textarea&gt;</code> or something - well here's why:</p>

<ol>
<li>Styling <code>contenteditable</code>'s is much easier</li>
<li>Allowing the input area to grow to fit the contained content "just works" - this is pretty hard to do with a <code>&lt;textarea&gt;</code>, though it can be done.</li>
<li>We can deliberately insert html into the <code>contenteditable</code> as the user types - for example i'm creating a tag editor, and by using a <code>contenteditable</code> I can render the tags nicely even as the user is typing - say, whenever the user enters a delimiter.</li>
</ol>

<p>Of course, <code>contenteditable</code>'s are not without problems - not least you have to deal with the html content that they produce (e.g. <code>&lt;p&gt;</code> or <code>&lt;div&gt;</code> tags produced by the enter key), and arbitrary html resulting from paste operations, but that's another story.</p>

<h2>How the bug manifests</h2>

<p>Anyways, I have a bunch of <code>contenteditable</code>'s in my web-app, all seemingly working fine. Then I notice that <em>one</em> of them is behaving a bit strangely: if I try to delete characters from the end of the content the <code>contenteditable</code> loses focus after deleting one character. </p>

<p>Being a complex app I have all kinds of event-handlers bound to these <code>contenteditable</code>'s, so I started removing the likely suspects one by one, trying to find the culprit.</p>

<p>Eventually I'd removed all the event-handlers and was scratching my head, wondering how on earth I could still have this problem on just one of my <code>contenteditable</code>'s. </p>

<p>I checked in Firefox - no problem, all working. I compiled the GWT app to pure javascript and ran outside of GWT development mode, just to be sure it wasn't some weird GWT-chrome-plugin bug - still suffering. I looked for other event handlers bound higher up the DOM tree. Still no joy.</p>

<h2>When the bug manifests</h2>

<p>Finally - almost in desperation - I started inspecting the CSS (surely the CSS could not be causing such bizarre behaviour, right? Uh, wrong!).</p>

<p>After some puzzling I reduced the replication steps down to some very simple html and an unfortunate collision of CSS styles:</p>

<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;bug&lt;/title&gt;
    &lt;style&gt;
      .s1 { display:inline; }
      .s2 { display:table; }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class="s1 s2" contenteditable="true"&gt;delete me&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Of course this CSS doesn't make sense - the two <code>display</code> settings conflict. That's easy to spot in a simple example like this, but much more difficult in a complex application with a large DOM tree and many many CSS styles. </p>

<p>As for the failure mode, you might expect one style to "win", and forgivably it could be a different style in different browsers. </p>

<p>What you really <em>don't</em> expect is the bizarre behaviour we experienced. The bug currently manifests in Chrome 15 (and 16 beta) on Linux, Mac and Windows(7), and is reported in the chromium issue tracker as <a href="http://code.google.com/p/chromium/issues/detail?id=107366">bug 107366</a>.</p>
</span>

              <ul class="keywords">
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=css">css</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=chrome">chrome</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=bug">bug</a></li>
                  <li><a itemprop="keywords" href="http://www.google.com/search?q=site:steveliles.github.com&q=contenteditable">contenteditable</a></li>
              </ul>
              <div style="clear:both"></div>


                <a name="comments"></a>
                <div id="disqus_thread"></div>
 	        <script type="text/javascript">    	     
	          var disqus_shortname = 'steveliles';
	          (function() {
	            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	          })();
	        </script>
	        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

                <div class="sharing">
		  <ul>
		    <li><a href="http://twitter.com/share?text=@steveliles" class="twitter" target="top">Tweet</a></li>
		    <li class="gplus"><g:plusone size="small" annotation="none"></g:plusone></li>
	          </ul>
                </div>
                
                <script type="text/javascript">
                  window.___gcfg = {lang: 'en-GB'};
                  (function() {
                    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                    po.src = 'https://apis.google.com/js/plusone.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                  })();
                </script>


            </div>
        </div>
        <div class="sidebar">
          <div>
            <div class="twitter-feed" show="4" account="steveliles">
              <h5>Recent Tweets</h5>            
              <ul class="tweets">
                <li class="tweet-template" style="display:none">        
                  <span class="text"></span>&nbsp;<span class="date" format="yyyy"></span>
                </li>
              </ul>
              <a href="https://twitter.com/steveliles" class="twitter-follow-button" data-show-count="false">Follow @steveliles</a>
	      <script src="//platform.twitter.com/widgets.js" type="text/javascript"></script>
            </div>
          </div>
          <div>
            <a href="article-archive.html"><h5>Recent Posts</h5></a>
            <ul>
                <li><a href="porting_ischangingconfigurations_to_api_levels_below_11.html">Porting isChangingConfigurations to API-levels below 11</a><span class="date"> - Oct 21, 2013</span></li>
                <li><a href="android_ssl_certificate_not_trusted.html">Android SSL - Certificate not trusted</a><span class="date"> - May 01, 2013</span></li>
                <li><a href="roman_numeral_conversion_in_clojure_part_ii.html">Roman numeral conversion in Clojure, part II</a><span class="date"> - Mar 03, 2013</span></li>
                <li><a href="roman_numeral_conversion_in_clojure.html">Roman numeral conversion in Clojure</a><span class="date"> - Feb 28, 2013</span></li>
                <li><a href="gwt_i18n_using_browser_locale.html">GWT i18n using browser locale</a><span class="date"> - Feb 27, 2013</span></li>
            </ul>
            <a href="article-archive.html">Older posts...</a>
          </div>
        </div>
      </div>
      <div class="nav">
        <div class="links">
          <div class="prev"><a title="previous" href="another_google_chrome_css_bug.html">Another Google Chrome CSS bug</a></div>
          <div class="next"><a title="next" href="pointing_a_domain_name_to_an_amazon_s3_bucket.html">Pointing a domain name to a...</a></div>
        </div>
      </div>
    </div>
    <script type="text/javascript" language="javascript" src="blog/blog.nocache.js"></script>
  </body>
</html>
